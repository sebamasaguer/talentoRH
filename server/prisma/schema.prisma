generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id        Int        @id @default(autoincrement())
  name      String     @unique
  agents    Agent[]
  positions Position[]
}

model FunctionalProfile {
  id        Int        @id @default(autoincrement())
  name      String     @unique
  agents    Agent[]
  positions Position[]
}

enum PositionStatus {
  Abierta
  Cubierta
  Desierta
}

enum AgentStatus {
  Disponible
  Asignado
}

model Agent {
  id                   String            @id @db.VarChar(20)
  fullName             String            @db.VarChar(100)
  dni                  String            @db.VarChar(20)
  originOrgId          Int
  originOrg            Organization      @relation(fields: [originOrgId], references: [id])
  profileId            Int
  profile              FunctionalProfile @relation(fields: [profileId], references: [id])
  keyCompetencies      String?           @db.Text
  workingHours         Int               @default(40)
  availableForRotation Boolean           @default(true)
  interviewDate        DateTime          @default(now()) @db.Date
  status               AgentStatus       @default(Disponible)
  matches              Match[]

  @@index([profileId])
}

model Position {
  id                String            @id @db.VarChar(20)
  requestingOrgId   Int
  requestingOrg     Organization      @relation(fields: [requestingOrgId], references: [id])
  requestingArea    String            @db.VarChar(100)
  profileRequiredId Int
  profileRequired   FunctionalProfile @relation(fields: [profileRequiredId], references: [id])
  mainFunctions     String?           @db.Text
  hoursRequired     Int               @default(40)
  requestDate       DateTime          @default(now()) @db.Date
  status            PositionStatus    @default(Abierta)
  matches           Match[]

  @@index([profileRequiredId])
  @@index([requestingOrgId])
}

model Match {
  id         Int      @id @default(autoincrement())
  agentId    String   @db.VarChar(20)
  agent      Agent    @relation(fields: [agentId], references: [id])
  positionId String   @db.VarChar(20)
  position   Position @relation(fields: [positionId], references: [id])
  matchDate  DateTime @default(now())
  score      Int?
  reasoning  String?  @db.Text

  @@index([agentId])
  @@index([positionId])
}

model User {
  id       Int    @id @default(autoincrement())
  email    String @unique
  password String
}
